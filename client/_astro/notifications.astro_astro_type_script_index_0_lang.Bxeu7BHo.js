import{o as w,d as I,a as p,g as E,s as f,b as y,q as b,c as C,f as D,k as j}from"./client.Ch7ienT3.js";document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("auth-loading-message"),n=document.getElementById("admin-login-container"),t=document.getElementById("page-content");w(y,async a=>{if(e&&(e.style.display="none"),a)try{const l=I(p,"users",a.uid),s=await E(l);s.exists()&&s.data().role==="admin"?(t&&(t.style.display="block"),n&&(n.style.display="none"),B()):(await f(y),n&&(n.style.display="block"),t&&(t.style.display="none"))}catch(l){console.error("Auth Check Error:",l),await f(y),n&&(n.style.display="block"),t&&(t.style.display="none")}else t&&(t.style.display="none"),n&&(n.style.display="block")})});async function B(){const e=document.getElementById("loader"),n=document.getElementById("notifications-content"),t=document.getElementById("error-display"),a=document.getElementById("back-link"),s=new URLSearchParams(window.location.search).get("projectId");if(!s){e.style.display="none",t.textContent="لم يتم تحديد مشروع. الرجاء العودة والمحاولة مرة أخرى.",t.style.display="block";return}a.href=`/admin/project-installments?projectId=${s}`;try{const r=await E(I(p,"projects",s));r.exists()&&(document.getElementById("project-name-header").textContent+=`: ${r.data().projectName}`);const m=new Date;m.setHours(0,0,0,0);const o=new Date;o.setDate(m.getDate()+7);const c=b(C(p,"installments"),D("projectId","==",s),D("status","==","pending")),d=(await j(c)).docs.map(i=>({id:i.id,...i.data()})),$=d.filter(i=>i.dueDate.toDate()<m),k=d.filter(i=>{const g=i.dueDate.toDate();return g>=m&&g<=o});h("overdue",$,s),h("upcoming",k,s),e.style.display="none",n.style.display="block"}catch(r){console.error("Error fetching notifications: ",r),e.style.display="none",t.textContent="حدث خطأ أثناء تحميل التنبيهات.",t.style.display="block"}}function h(e,n,t){const a=`${e}-installments-list`,l=`no-${e}-message`,s=document.getElementById(a),r=document.getElementById(l);if(n.length===0){r.style.display="block",s.style.display="none";return}s.innerHTML="",r.style.display="none",s.style.display="grid",n.sort((o,c)=>o.dueDate.toDate()-c.dueDate.toDate()).forEach(o=>{const c=document.createElement("a");c.className=`installment-card ${e}`,c.href=`/admin/contract-details?projectId=${t}&customerName=${encodeURIComponent(o.customerName)}`;const u=P(o.dueDate.toDate());let d="";e==="overdue"?d=`متأخر ${-u} يوم`:d=u===0?"اليوم":`خلال ${u} يوم`,c.innerHTML=`
                <div class="card-header">${o.customerName} ${o.customerPhone?`(${o.customerPhone})`:""}</div>
                <div class="card-details">
                    <p><strong>بيان القسط:</strong> ${o.installmentName||"-"}</p>
                    <p><strong>المبلغ:</strong> <span class="amount">${L(o.installmentAmount)}</span></p>
                    <p><strong>تاريخ الاستحقاق:</strong> ${v(o.dueDate)}</p>
                    <p><strong>الحالة:</strong> <span class="status-${e}">${d}</span></p>
                </div>
            `,s.appendChild(c)})}const L=e=>(e||0).toLocaleString("ar-EG",{style:"currency",currency:"EGP"}),v=e=>e?e.toDate().toLocaleDateString("ar-EG",{year:"numeric",month:"long",day:"numeric"}):"-",P=e=>{const n=new Date;n.setHours(0,0,0,0);const t=new Date(e);t.setHours(0,0,0,0);const a=t-n;return Math.ceil(a/(1e3*60*60*24))};
