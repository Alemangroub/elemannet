import{o as k,d as b,a as p,g as D,s as h,b as y,q as M,e as C,f as $,c as A,h as P,i as U,u as q}from"./client.Ch7ienT3.js";document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("auth-loading-message"),t=document.getElementById("admin-login-container"),n=document.getElementById("page-content");k(y,async a=>{if(s&&(s.style.display="none"),a)try{const d=b(p,"users",a.uid),l=await D(d);if(l.exists()&&l.data().role==="admin"){n&&(n.style.display="block"),t&&(t.style.display="none");const c=document.getElementById("logout-button");c&&c.addEventListener("click",async()=>{await h(y),window.location.href="/admin"}),S()}else await h(y),t&&(t.style.display="block"),n&&(n.style.display="none")}catch(d){console.error("Auth Check Error:",d),await h(y),t&&(t.style.display="block"),n&&(n.style.display="none")}else n&&(n.style.display="none"),t&&(t.style.display="block")})});function S(){const s=document.getElementById("projects-list"),t=document.getElementById("no-projects-message"),n=document.querySelector(".table-wrapper"),a=document.getElementById("delete-modal"),d=document.getElementById("confirm-delete-btn"),l=document.getElementById("cancel-delete-btn"),c=document.getElementById("unarchive-modal"),j=document.getElementById("confirm-unarchive-btn"),B=document.getElementById("cancel-unarchive-btn");let r=null,u=null;const L=M(A(p,"projects"),$("archived","==",!0),C("createdAt","desc"));P(L,e=>{const o=e.docs;n.style.display=o.length===0?"none":"",t.textContent=o.length===0?"لا توجد مشاريع مؤرشفة حالياً.":"",s&&(s.innerHTML=o.map(i=>{const m=i.data(),w=m.supervisors?m.supervisors.map(I=>I.name).join(", "):"-";return`
            <tr data-id="${i.id}">
              <td data-label="اسم المشروع" class="project-name-cell">${m.projectName||"-"}</td>
              <td data-label="العنوان">${m.projectAddress||"-"}</td>
              <td data-label="المشرفون">${w}</td>
              <td data-label="الإجراءات" class="btn-action-cell">
                <button class="btn btn-unarchive-custom">إلغاء الأرشفة</button>
                <button class="btn btn-delete-custom">حذف</button>
              </td>
            </tr>
          `}).join(""))});function v(e){e.classList.add("visible"),document.body.style.overflow="hidden"}function E(e){e.classList.remove("visible"),document.body.style.overflow=""}s.addEventListener("click",e=>{const o=e.target.closest("tr");if(o)if(e.target.classList.contains("btn-delete-custom"))e.stopPropagation(),r=o.dataset.id,v(a);else if(e.target.classList.contains("btn-unarchive-custom"))e.stopPropagation(),u=o.dataset.id,v(c);else{const i=o.dataset.id;i&&(window.location.href=`/admin/projects/${i}`)}});function g(){E(a),r=null}l.addEventListener("click",g),a.addEventListener("click",e=>{e.target===a&&g()}),d.addEventListener("click",async()=>{if(r){try{await U(b(p,"projects",r))}catch(e){console.error("Error deleting document: ",e)}g()}});function f(){E(c),u=null}B.addEventListener("click",f),c.addEventListener("click",e=>{e.target===c&&f()}),j.addEventListener("click",async()=>{if(u){try{const e=b(p,"projects",u);await q(e,{archived:!1})}catch(e){console.error("Error unarchiving document: ",e)}f()}})}
